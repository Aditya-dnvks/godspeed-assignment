# config, inputs, ouputs, vars
# Environment variables will be loaded in config files via some convention
namespace: com.pinelabs.lenders_integration
id: create_account_hdfc
summary: Multiplexing create loan for hdfc api calls
tasks: 
    - id: step1 # the response of this will be accessible within the parent step key, under the step1 sub key
      description: create account in the bank
      fn: com.gs.http
      inputs:
        url: {{datasources.hdfc.create_user}}/{{inputs.pan}}
        body: # body is {user_name: string, address: string}}
          user_name:  {{inputs.body.user_name}}
          address:  {{inputs.body.address}}
        query:
          user_name: {{inputs.params.user_name}}
        headers:
          xyz: 2134234
      retry: #Kestra spec compliant retry mechanism. By default turned off.
        maxAttempt: 5
        type: constant
        interval: PT15M
      on_error:
        continue: true # default continue is false
    - id: step2 # the response of this will be accessible within the parent step key, under the step1 sub key
      description: create account in the bank
      fn: com.gs.http
      inputs:
        url: {{config.banks.urls.hdfc.create_user}}/{{inputs.pan}}
        body: # body is {user_name: string, address: string}}
          user_name:  {{inputs.body.user_name}}
          address:  {{inputs.body.address}}
        query:
          user_name: {{inputs.params.user_name}}
        headers:
          xyz: 2134234
        retries: 3
        backoff: 100
      on_error:
        continue: true # default continue is false